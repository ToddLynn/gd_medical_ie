(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e5adbea"],{"25f0":function(e,t,n){"use strict";var r=n("6eeb"),o=n("825a"),i=n("d039"),s=n("ad6d"),a="toString",l=RegExp.prototype,c=l[a],u=i((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),h=c.name!=a;(u||h)&&r(RegExp.prototype,a,(function(){var e=o(this),t=String(e.source),n=e.flags,r=String(void 0===n&&e instanceof RegExp&&!("flags"in l)?s.call(e):n);return"/"+t+"/"+r}),{unsafe:!0})},"53ca":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}},"7db0":function(e,t,n){"use strict";var r=n("23e7"),o=n("b727").find,i=n("44d2"),s=n("ae40"),a="find",l=!0,c=s(a);a in[]&&Array(1)[a]((function(){l=!1})),r({target:"Array",proto:!0,forced:l||!c},{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),i(a)},"81d5":function(e,t,n){"use strict";var r=n("7b0b"),o=n("23cb"),i=n("50c4");e.exports=function(e){var t=r(this),n=i(t.length),s=arguments.length,a=o(s>1?arguments[1]:void 0,n),l=s>2?arguments[2]:void 0,c=void 0===l?n:o(l,n);while(c>a)t[a++]=e;return t}},a21c:function(e,t,n){!function(t,n){e.exports=n()}(window,(function(){return n={},e.m=t=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SVGNS="http://www.w3.org/2000/svg"},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s,a,l,c=n(4),u=n(3);function h(){var e=null!==a&&a.apply(this,arguments)||this;return e.entities=new Map,e.nextId=0,e}s=t.Base||(t.Base={}),a=u.EventEmitter,o(h,a),Object.defineProperty(h.prototype,"json",{get:function(){var e,t,n=[];try{for(var r=i(this.values()),o=r.next();!o.done;o=r.next()){var s=o.value;"json"in s?n.push(s.json):n.push(JSON.parse(JSON.stringify(s)))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"length",{get:function(){return this.entities.size},enumerable:!0,configurable:!0}),h.prototype.get=function(e){return c.assert(this.has(e),"There's no Entity which id="+e+" in repo!"),this.entities.get(e)},h.prototype.has=function(e){return this.entities.has(e)},h.prototype.set=function(e,t){var n=this.has(e);return this.entities.set(e,t),n?this.emit("updated",t):(this.nextId<e+1&&(this.nextId=e+1),this.emit("created",t)),this},h.prototype.add=function(e){if("id"in e){var t=e.id;return c.assert(!this.has(t),"reAdd "+t+"!"),null===t?(e.id=this.nextId,this.add(e)):(this.set(t,e),t)}var n=this.nextId;return this.set(n,e),n},h.prototype[Symbol.iterator]=function(){return this.entities[Symbol.iterator]()},h.prototype.delete=function(e){if("number"==typeof e&&this.has(e)){var t=this.get(e);return this.entities.delete(e),this.emit("removed",t),!0}return"number"!=typeof e&&"id"in e&&this.delete(e.id)},h.prototype.values=function(){return this.entities.values()},l=h,s.Repository=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(Object.defineProperty(o.prototype,"isSome",{get:function(){return null!==this.value},enumerable:!0,configurable:!0}),o.prototype.map=function(e){return null===this.value?new o(null):new o(e(this.value))},o.prototype.flatMap=function(e){return null===this.value?new o(null):s(e(this.value).toNullable())},o.prototype.orElse=function(e){return null===this.value?e:this.value},o.prototype.toNullable=function(){return this.value},o.prototype.match=function(e,t){return this.isSome?e:t},o);function o(e){this.value=e}function i(e){return new r(e)}function s(e){return null==e?t.none:i(e)}t.Option=r,t.none=new r(null),t.some=i,t.fromNullable=s,t.fromTry=function(e){try{return i(e())}catch(e){return t.none}}},function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}((e.exports=a).EventEmitter=a).prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var l=10;function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var o,i,s;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),0<(o=c(e))&&s.length>o&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,function(e){console&&console.warn&&console.warn(e)}(a)}return e}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,i(this.listener,this.target,e))}.bind(r);return o.listener=n,r.wrapFn=o}function f(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):p(o,o.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(0<t.length&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,u=p(l,c);for(n=0;n<c;++n)i(u[n],this,t)}return!0},a.prototype.on=a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},a.prototype.off=a.prototype.removeListener=function(e,t){var n,r,o,i,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;0<=i;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return 0<this._eventsCount?r(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shadeColor=function(e,t){var n=parseInt(e.slice(1),16),r=Math.min((n>>16)+(n>>16)*t/100,255),o=Math.min((n>>8&255)+(n>>8&255)*t/100,255);return"#"+(Math.min((255&n)+(255&n)*t/100,255)|o<<8|r<<16).toString(16)},t.addAlpha=function(e,t){var n=parseInt(e.slice(1),16);return"rgba("+(n>>16)+","+(n>>8&255)+","+(255&n)+","+t+"%)"}},function(e,t,n){"use strict";function r(){this.layer=0}Object.defineProperty(t,"__esModule",{value:!0}),t.TopContextUser=r,t.overLaps=function e(t,n){return t.layer===n.layer&&(t.left>n.left?e(n,t):!(t.left+t.width<n.left))}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(6),l=n(0),c=n(1),u=n(5);!function(e){var t,n=(t=a.TopContextUser,o(r,t),Object.defineProperty(r.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lineIn",{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"view",{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"highLightWidth",{get:function(){return this.view.contentWidth(this.store.startIndex,this.store.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"highLightLeft",{get:function(){return this.view.contentWidth(this.lineIn.startIndex,this.store.startIndex)+this.lineIn.view.paddingLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"middle",{get:function(){return this.highLightLeft+this.highLightWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"labelLeft",{get:function(){return this.middle-this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"labelRight",{get:function(){return this.middle+this.labelWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"labelWidth",{get:function(){return this.view.labelFont.widthOf(this.store.category.text)+this.config.labelPadding+2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return"max"===this.config.labelWidthCalcMethod?this.labelWidth>this.highLightWidth?this.labelLeft:this.highLightLeft:this.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return"max"===this.config.labelWidthCalcMethod?this.labelWidth>this.highLightWidth-1?this.labelWidth:this.highLightWidth-1:this.labelWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"annotationY",{get:function(){return-this.view.topContextLayerHeight*(this.layer-1)-(this.view.labelFont.lineHeight+2+2*this.config.labelPadding+this.config.bracketWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalY",{get:function(){return this.lineIn.y+this.annotationY},enumerable:!0,configurable:!0}),r.prototype.render=function(){var e;this.svgElement=document.createElementNS(l.SVGNS,"g"),(e=this.svgElement.classList).add.apply(e,s(this.config.labelClasses));var t=this.createHighLightElement(),n=this.createAnnotationElement(),r=this.view.topContextLayerHeight*(this.layer-1),o=this.createBracketElement(this.highLightWidth,-r,0,-r,this.config.bracketWidth);return this.svgElement.appendChild(t),this.svgElement.appendChild(n),this.svgElement.appendChild(o),this.svgElement},r.prototype.update=function(){this.svgElement.style.transform="translate("+this.highLightLeft+"px,"+this.lineIn.y+"px)"},r.prototype.remove=function(){this.svgElement.remove()},r.prototype.createHighLightElement=function(){var e=document.createElementNS(l.SVGNS,"rect"),t=this.store.category.color;return e.setAttribute("height",this.lineIn.view.contentFont.lineHeight.toString()),e.setAttribute("width",this.highLightWidth.toString()),e.setAttribute("fill",/^#/g.test(t)?u.addAlpha(t,70):t),e},r.prototype.createBracketElement=function(e,t,n,r,o,i){void 0===i&&(i=.6);var s=e-n,a=t-r,c=Math.sqrt(s*s+a*a),u=e+i*o*(a/=c),h=t-i*o*(s/=c),f=e-.25*c*s+(1-i)*o*a,d=t-.25*c*a-(1-i)*o*s,p=e-.5*c*s+o*a,y=t-.5*c*a-o*s,v=n+i*o*a,m=r-i*o*s,b=e-.75*c*s+(1-i)*o*a,g=t-.75*c*a-(1-i)*o*s,w=document.createElementNS(l.SVGNS,"path");return w.setAttribute("d","M"+e+","+t+"Q"+u+","+h+","+f+","+d+"T"+p+","+y+"M"+n+","+r+"Q"+v+","+m+","+b+","+g+"T"+p+","+y),w.setAttribute("fill","none"),w.setAttribute("stroke",this.store.category.borderColor),w},r.prototype.createAnnotationElement=function(){var e=this,t=this.view.labelCategoryElementFactoryRepository.get(this.store.category.id).create();return t.style.transform="translate("+(this.highLightWidth-this.labelWidth)/2+"px,"+this.annotationY+"px)",t.onclick=function(t){e.view.root.emit("labelClicked",e.id,t)},t.ondblclick=function(t){e.view.root.emit("labelDoubleClicked",e.id,t)},t.oncontextmenu=function(t){e.view.root.emit("labelRightClicked",e.id,t),t.preventDefault()},t.onmouseenter=function(){e.svgElement.classList.add("hover"),Array.from(e.store.connectionsFrom).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.addHover("from")})),Array.from(e.store.connectionsTo).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.addHover("to")}))},t.onmouseleave=function(){e.svgElement.classList.remove("hover"),Array.from(e.store.connectionsFrom).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.removeHover("from")})),Array.from(e.store.connectionsTo).map((function(t){return e.view.connectionViewRepository.get(t.id)})).map((function(e){return e.removeHover("to")}))},t},r);function r(e,n,r){var o=t.call(this)||this;return o.store=e,o.contextIn=n,o.config=r,o.layer=0,o.svgElement=null,o}e.Entity=n;var i,h=(i=c.Base.Repository,o(f,i),f.prototype.get=function(e){return this.entities.get(e)},f);function f(){return null!==i&&i.apply(this,arguments)||this}e.Repository=h}(t.LabelView||(t.LabelView={}))},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);!function(e){var t=(Object.defineProperty(n.prototype,"startIndex",{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endIndex",{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),n.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},Object.defineProperty(n.prototype,"category",{get:function(){return this.root.labelCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"json",{get:function(){return{id:this.id,categoryId:this.categoryId,startIndex:this.startIndex,endIndex:this.endIndex}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sameLineConnections",{get:function(){var e,t,n=[];try{for(var r=i(this.root.connectionRepo.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.priorLabel===this&&n.push(s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"connectionsFrom",{get:function(){var e,t,n=new Set;try{for(var r=i(this.root.connectionRepo.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.from===this&&n.add(s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"connectionsTo",{get:function(){var e,t,n=new Set;try{for(var r=i(this.root.connectionRepo.values()),o=r.next();!o.done;o=r.next()){var s=o.value;s.to===this&&n.add(s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"allConnections",{get:function(){return new Set(Array.prototype.concat(Array.from(this.connectionsFrom),Array.from(this.connectionsTo)))},enumerable:!0,configurable:!0}),n);function n(e,t,n,r,o){this.id=e,this.categoryId=t,this._startIndex=n,this._endIndex=r,this.root=o}e.Entity=t;var r,a,l=(r=s.Base.Repository,o(c,r),c.prototype.set=function(e,t){return this.againstMultipleLabelWith(t)?console.warn("try set a label against the againstMultipleLabelWith rule!"):r.prototype.set.call(this,e,t),this},c.prototype.add=function(e){return this.againstMultipleLabelWith(e)?(console.warn("try add a label against the againstMultipleLabelWith rule!"),-1):r.prototype.add.call(this,e)},c.prototype.againstMultipleLabelWith=function(e){function t(e,t){return e.startIndex===t.startIndex&&e.endIndex===t.endIndex}var n="notAllowed"===this.config.allowMultipleLabel?t:function(e,n){return t(e,n)&&e.categoryId==n.categoryId};return Array.from(this.values()).some((function(t){return n(t,e)}))},c.prototype.getEntitiesInRange=function(e,t){return Array.from(this.entities.values()).filter((function(n){return e<=n.startIndex&&n.endIndex<=t}))},c.prototype.getEntitiesCross=function(e){return Array.from(this.entities.values()).filter((function(t){return t.startIndex<=e&&e<t.endIndex}))},c);function c(e){var t=r.call(this)||this;return t.config=e,t}function u(e,n){return new t(e.id,e.categoryId,e.startIndex,e.endIndex,n)}e.Repository=l,(a=e.Factory||(e.Factory={})).create=u,a.createAll=function(e,t){return e.map((function(e){return u(e,t)}))}}(t.Label||(t.Label={}))},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);!function(e){var t=(Object.defineProperty(n.prototype,"category",{get:function(){return this.root.connectionCategoryRepo.get(this.categoryId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"from",{get:function(){return this.root.labelRepo.get(this.fromId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"to",{get:function(){return this.root.labelRepo.get(this.toId)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"priorLabel",{get:function(){return this.from.startIndex<this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"posteriorLabel",{get:function(){return this.from.startIndex>=this.to.startIndex?this.from:this.to},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"json",{get:function(){return{id:this.id,categoryId:this.categoryId,fromId:this.fromId,toId:this.toId}},enumerable:!0,configurable:!0}),n);function n(e,t,n,r,o){this.id=e,this.categoryId=t,this.fromId=n,this.toId=r,this.root=o}e.Entity=t;var r,s,a=(r=i.Base.Repository,o(l,r),l.prototype.set=function(e,t){return this.againstMultipleConnectionRuleWith(t)?console.warn("try set a label against the checkMultipleLabel rule!"):r.prototype.set.call(this,e,t),this},l.prototype.add=function(e){return this.againstMultipleConnectionRuleWith(e)?(console.warn("try add a label against the checkMultipleLabel rule!"),-1):r.prototype.add.call(this,e)},l.prototype.againstMultipleConnectionRuleWith=function(e){function t(e,t){return e.from===t.from&&e.to===t.to}var n="notAllowed"===this.config.allowMultipleConnection?t:function(e,n){return t(e,n)&&e.categoryId==n.categoryId};return Array.from(this.values()).some((function(t){return n(t,e)}))},l);function l(e){var t=r.call(this)||this;return t.config=e,t}function c(e,n){return new t(e.id,e.categoryId,e.fromId,e.toId,n)}e.Repository=a,(s=e.Factory||(e.Factory={})).create=c,s.createAll=function(e,t){return e.map((function(e){return c(e,t)}))}}(t.Connection||(t.Connection={}))},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),l=n(0),c=n(6);!function(e){var t,n=(t=c.TopContextUser,o(r,t),Object.defineProperty(r.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lineIn",{get:function(){return this.contextIn.belongTo},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"view",{get:function(){return this.lineIn.view},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sameLineLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.priorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mayNotSameLineLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.posteriorLabel.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fromLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.from.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"toLabelView",{get:function(){return this.view.labelViewRepository.get(this.store.to.id)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"leftLabelView",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rightLabelView",{get:function(){return this.fromLabelView.labelLeft>=this.toLabelView.labelLeft?this.fromLabelView:this.toLabelView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"middle",{get:function(){return(this.leftLabelView.labelLeft+this.rightLabelView.labelRight)/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textWidth",{get:function(){return this.view.connectionFont.widthOf(this.store.category.text)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textLeft",{get:function(){return this.middle-this.textWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lineIncludedWidth",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.toLabelView.labelRight-this.fromLabelView.labelLeft:this.fromLabelView.labelRight-this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lineIncludedLeft",{get:function(){return this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.fromLabelView.labelLeft:this.toLabelView.labelLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return"text"===this.config.connectionWidthCalcMethod?this.textWidth:this.lineIncludedWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return"text"===this.config.connectionWidthCalcMethod?this.textLeft:this.lineIncludedLeft},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"globalY",{get:function(){return this.lineIn.y-this.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),r.prototype.render=function(){var e=this;this.svgElement=document.createElementNS(l.SVGNS,"g");var t=this.view.connectionCategoryElementFactoryRepository.get(this.store.category.id).create();return this.svgElement.appendChild(t),this.svgElement.style.cursor="pointer",this.svgElement.onclick=function(t){e.view.root.emit("connectionClicked",e.id,t)},this.svgElement.ondblclick=function(t){e.view.root.emit("connectionDoubleClicked",e.id,t)},this.svgElement.oncontextmenu=function(t){e.view.root.emit("connectionRightClicked",e.id,t),t.preventDefault()},this.svgElement.onmouseenter=function(){e.svgElement.classList.add("hover"),e.lineElement.classList.add("hover")},this.svgElement.onmouseleave=function(){e.svgElement.classList.remove("hover"),e.lineElement.classList.remove("hover")},this.renderLine(),this.svgElement},r.prototype.update=function(){this.svgElement.style.transform="translate("+this.textLeft+"px,"+this.globalY+"px)",this.updateLine()},r.prototype.addHover=function(e){this.svgElement.classList.add("hover-"+e),this.lineElement.classList.add("hover-"+e)},r.prototype.removeHover=function(e){this.svgElement.classList.remove("hover-"+e),this.lineElement.classList.remove("hover-"+e)},r.prototype.remove=function(){this.svgElement.remove(),this.lineElement.remove()},r.prototype.updateLine=function(){var e=this.globalY+this.view.topContextLayerHeight/2-this.view.labelFont.fontSize+2;this.fromLabelView.labelLeft<this.toLabelView.labelLeft?this.lineElement.setAttribute("d","\n                    M "+(this.fromLabelView.labelLeft+1)+"   "+(this.fromLabelView.globalY+1)+"\n                    C "+(this.fromLabelView.labelLeft-8)+"  "+e+",\n                      "+(this.fromLabelView.labelLeft-8)+"  "+e+",\n                      "+(this.fromLabelView.labelLeft+1)+"   "+e+"\n                    L "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+" "+e+"\n                    C "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+"  "+e+",\n                      "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth+8)+"  "+e+",\n                      "+(this.toLabelView.labelLeft+this.toLabelView.labelWidth)+"   "+(this.toLabelView.globalY-1)+"\n                "):this.lineElement.setAttribute("d","\n                    M "+(this.fromLabelView.labelRight-1)+"   "+(this.fromLabelView.globalY+1)+"\n                    C "+(this.fromLabelView.labelRight+8)+"  "+e+",\n                      "+(this.fromLabelView.labelRight+8)+"  "+e+",\n                      "+(this.fromLabelView.labelRight-1)+"   "+e+"\n                    L "+this.toLabelView.labelLeft+"          "+e+"\n                    C "+(this.toLabelView.labelLeft-8)+"  "+e+",\n                      "+(this.toLabelView.labelLeft-8)+"  "+e+",\n                      "+this.toLabelView.labelLeft+"   "+(this.toLabelView.globalY-1)+"\n                ")},r.prototype.renderLine=function(){var e;this.lineElement=document.createElementNS(l.SVGNS,"path"),(e=this.lineElement.classList).add.apply(e,s(this.config.connectionClasses.map((function(e){return e+"-line"})))),this.lineElement.setAttribute("fill","none"),this.lineElement.style.markerEnd="url(#marker-arrow)",this.updateLine(),this.contextIn.backgroundElement.appendChild(this.lineElement)},r);function r(e,n,r){var o=t.call(this)||this;return o.store=e,o.contextIn=n,o.config=r,o.svgElement=null,o.lineElement=null,o}e.Entity=n;var i,u=(i=a.Base.Repository,o(h,i),h);function h(){return null!==i&&i.apply(this,arguments)||this}e.Repository=u}(t.ConnectionView||(t.ConnectionView={}))},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i,s,a=n(0);function l(e,t,n,r,o,i){this.fontFamily=e,this.fontSize=t,this.fontWeight=n,this.lineHeight=r,this.topToBaseLine=o,this.width=i}i=t.Font||(t.Font={}),l.prototype.widthOf=function(e){var t=this;return"string"==typeof e?this.widthOf(Array.from(e)):e.map((function(e){return t.width.get(e)})).reduce((function(e,t){return e+t}),0)},s=l,i.ValueObject=s,function(e){function t(e,t,n){var r=new Map,o=new Set(e);o.delete("\n");var i=Array.from(o);t.textContent=i.join(""),t.parentNode.parentNode.insertBefore(n,t.parentNode),i.forEach((function(e,n){r.set(e,t.getExtentOfChar(n).width)}));var a=n.getBoundingClientRect().top-t.getBoundingClientRect().top,l=parseFloat(window.getComputedStyle(t).fontSize),c=window.getComputedStyle(t).fontFamily,u=window.getComputedStyle(t).fontWeight,h=t.getBoundingClientRect().height;return new s(c,l,u,h,a,r)}e.create=t;var n=(r.prototype.thanCreate=function(e,n){var r,i;(r=this.measuringElement.classList).add.apply(r,o(e));var s=t(n,this.measuringElement,this.baseLineReferenceElement);return(i=this.measuringElement.classList).remove.apply(i,o(e)),this.result.push(s),this},r.prototype.endBatch=function(){return this.baseLineReferenceElement.remove(),this.measuringElement.remove(),this.result},r);function r(e,t){this.svgElement=e,this.textElement=t,this.baseLineReferenceElement=document.createElementNS(a.SVGNS,"rect"),this.baseLineReferenceElement.setAttribute("width","1px"),this.baseLineReferenceElement.setAttribute("height","1px"),this.svgElement.appendChild(this.baseLineReferenceElement),this.measuringElement=document.createElementNS(a.SVGNS,"tspan"),this.textElement.appendChild(this.measuringElement),this.result=[]}e.startBatch=function(e,t){return new n(e,t)}}(i.Factory||(i.Factory={})),(i.Service||(i.Service={})).measureMore=function(e,t,n,r){var i,s=new Set(t);s.delete("\n");var l=Array.from(s).filter((function(t){return!e.width.has(t)}));if(0<l.length){var c=document.createElementNS(a.SVGNS,"tspan");(i=c.classList).add.apply(i,o(n)),c.textContent=l.join(""),r.appendChild(c),l.forEach((function(t,n){e.width.set(t,c.getExtentOfChar(n).width)})),c.remove()}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.Annotator=r.Annotator;var o=n(27),i=n(28),s=n(29),a={Connection:o.Connection,Label:i.Label,Content:s.Content};t.Action=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,s=n(3),a=n(14),l=n(17),c=n(0),u=n(24),h=n(25),f=n(26),d=(i=s.EventEmitter,o(p,i),p.prototype.applyAction=function(e){e.apply(this.store)},p.prototype.export=function(){this.view.contentEditor.hide();var e=this.view.svgElement.outerHTML.replace(/&nbsp;/," ");return this.view.contentEditor.show(),e},p.prototype.remove=function(){this.view.svgElement.remove(),this.store.config.contentEditable&&this.view.contentEditor.remove()},p);function p(e,t,n){var r=i.call(this)||this;r.containerElement=t,r.configInput=n;var o=u.parseInput(n||{});r.store=new a.Store(o),r.store.json="string"==typeof e?JSON.parse(e):e;var s=document.createElementNS(c.SVGNS,"svg");return s.setAttribute("xmlns",c.SVGNS),t.appendChild(s),r.view=new l.View(r,s,o),r.textSelectionHandler=new h.TextSelectionHandler(r,o),r.twoLabelsClickedHandler=new f.TwoLabelsClickedHandler(r,o),r}t.Annotator=d},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,s=n(15),a=n(8),l=n(16),c=n(9),u=n(3),h=(i=u.EventEmitter,o(f,i),Object.defineProperty(f.prototype,"content",{get:function(){return this._content},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"json",{get:function(){return{content:this._content,labelCategories:this.labelCategoryRepo.json,labels:this.labelRepo.json,connectionCategories:this.connectionCategoryRepo.json,connections:this.connectionRepo.json}},set:function(e){var t=this;this._content=e.content.endsWith("\n")?e.content:e.content+"\n",s.LabelCategory.Factory.createAll(e.labelCategories,this.config).map((function(e){return t.labelCategoryRepo.add(e)})),a.Label.Factory.createAll(e.labels,this).map((function(e){return t.labelRepo.add(e)})),e.connectionCategories.map((function(e){return t.connectionCategoryRepo.add(e)})),c.Connection.Factory.createAll(e.connections,this).map((function(e){return t.connectionRepo.add(e)}))},enumerable:!0,configurable:!0}),f.prototype.contentSlice=function(e,t){return this.content.slice(e,t)},f.prototype.moveLabels=function(e,t){Array.from(this.labelRepo.values()).filter((function(t){return t.startIndex>=e})).map((function(e){return e.move(t)}))},f.prototype.spliceContent=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=e+t;if(0===t||void 0===Array.from(this.labelRepo.values()).find((function(t){return t.startIndex<=e&&e<t.endIndex||t.startIndex<o&&o<t.endIndex}))){var i=this.content.slice(0,e),s=this.content.slice(e,e+t),a=n.join(""),l=this.content.slice(e+t);this._content=i+a+l,this.moveLabels(e+t,a.length-s.length),this.emit("contentSpliced",e,s,a)}},f);function f(e){var t=i.call(this)||this;return t._content="",t.config=e,t.labelCategoryRepo=new s.LabelCategory.Repository,t.labelRepo=new a.Label.Repository(e),t.connectionCategoryRepo=new l.ConnectionCategory.Repository,t.connectionRepo=new c.Connection.Repository(e),t}t.Store=h},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,s,a,l,c=n(1),u=n(5);function h(){return null!==s&&s.apply(this,arguments)||this}function f(e,t){var n=e.borderColor,r=e.color;return!e.borderColor&&e["border-color"]&&(n=e["border-color"]),e.color||(r=t),e.borderColor||(n=u.shadeColor(r,-30)),{id:e.id,text:e.text,color:r,borderColor:n}}i=t.LabelCategory||(t.LabelCategory={}),s=c.Base.Repository,o(h,s),l=h,i.Repository=l,(a=i.Factory||(i.Factory={})).create=f,a.createAll=function(e,t){return e.map((function(e){return f(e,t.defaultLabelColor)}))}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i,s,a,l=n(1);function c(){return null!==s&&s.apply(this,arguments)||this}i=t.ConnectionCategory||(t.ConnectionCategory={}),s=l.Base.Repository,o(c,s),a=c,i.Repository=a},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),a=n(18),l=n(11),c=n(21),u=n(7),h=n(10),f=n(22),d=n(23),p=n(2),y=(v.layoutTopContextsAfter=function(e){for(;e.next.isSome;)e.topContext.update(),e=e.next.toNullable();e.topContext.update()},v.prototype.constructLabelViewsForLine=function(e){var t=this,n=this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map((function(n){return new u.LabelView.Entity(n,e.topContext,t.config)}));return n.map((function(e){return t.labelViewRepository.add(e)})),n.map((function(t){return e.topContext.addChild(t)})),n},v.prototype.constructConnectionsForLine=function(e){var t=this;return this.store.labelRepo.getEntitiesInRange(e.startIndex,e.endIndex).map((function(n){var r=n.sameLineConnections.filter((function(e){return!t.connectionViewRepository.has(e.id)})).map((function(n){return new h.ConnectionView.Entity(n,e.topContext,t.config)}));return r.map((function(e){return t.connectionViewRepository.add(e)})),r.map((function(t){return e.topContext.addChild(t)})),r})).reduce((function(e,t){return e.concat(t)}),[])},Object.defineProperty(v.prototype,"height",{get:function(){var e=this;return this.lines.reduce((function(t,n){return t+n.height+e.contentFont.fontSize*(e.config.lineHeight-1)}),20)},enumerable:!0,configurable:!0}),v.createMarkerElement=function(){var e=document.createElementNS(s.SVGNS,"path");e.setAttribute("d","M0,4 L0,8 L6,6 L0,4 L0,8"),e.setAttribute("stroke","#000000"),e.setAttribute("fill","#000000");var t=document.createElementNS(s.SVGNS,"marker");return t.setAttribute("id","marker-arrow"),t.setAttribute("markerWidth","8"),t.setAttribute("markerHeight","10"),t.setAttribute("orient","auto"),t.setAttribute("refX","5"),t.setAttribute("refY","6"),t.appendChild(e),t},v.prototype.contentWidth=function(e,t){return this.contentFont.widthOf(this.store.contentSlice(e,t))},v.prototype.removeLine=function(e){var t=this;e.remove(),e.topContext.children.forEach((function(e){e instanceof u.LabelView.Entity?t.labelViewRepository.delete(e):e instanceof h.ConnectionView.Entity&&t.connectionViewRepository.delete(e)}))},v.prototype.registerEventHandlers=function(){var e=this;this.textElement.onmouseup=function(t){"Range"===window.getSelection().type?e.root.textSelectionHandler.textSelected():e.config.contentEditable&&e.contentEditor.caretChanged(t.clientY)},this.store.labelRepo.on("created",this.onLabelCreated.bind(this)),this.store.labelRepo.on("removed",(function(t){var n=e.labelViewRepository.get(t.id);n.lineIn.topContext.removeChild(n),n.remove(),e.labelViewRepository.delete(n),n.lineIn.topContext.update(),n.lineIn.update(),v.layoutTopContextsAfter(n.lineIn),e.config.contentEditable&&e.contentEditor.update()})),this.store.connectionRepo.on("created",this.onConnectionCreated.bind(this)),this.store.connectionRepo.on("removed",(function(t){var n=e.connectionViewRepository.get(t.id);n.lineIn.topContext.removeChild(n),n.remove(),e.connectionViewRepository.delete(n),n.lineIn.topContext.update(),n.lineIn.update(),v.layoutTopContextsAfter(n.lineIn),e.config.contentEditable&&e.contentEditor.update()})),this.config.contentEditable&&this.store.on("contentSpliced",this.onContentSpliced.bind(this))},v.prototype.rerenderLines=function(e,t){for(var n,r,s,l,c,u,h,f=this.lines[0].svgElement.parentElement,d=e;d<=t;++d)this.removeLine(this.lines[d]);var y=this.lines[e],v=this.lines[t],m=a.Line.Service.divide(this,y.startIndex,v.endIndex);for(0!==m.length&&(m[0].last=y.last,y.last.map((function(e){return e.next=p.some(m[0])})),m[m.length-1].next=v.next,v.next.map((function(e){return e.last=p.some(m[m.length-1])})),(n=this.lines).splice.apply(n,o([e,t-e+1],m)),0===e?v.next.isSome?m[0].insertBefore(v.next):m[0].insertInto(f):m[0].insertAfter(y.last)),d=1;d<m.length;++d)m[d].insertAfter(p.some(m[d-1]));function b(e){g.constructLabelViewsForLine(e).map((function(t){return e.topContext.renderChild(t)}))}var g=this;try{for(var w=i(m),x=w.next();!x.done;x=w.next())b(O=x.value)}catch(e){r={error:e}}finally{try{x&&!x.done&&(s=w.return)&&s.call(w)}finally{if(r)throw r.error}}function E(e){L.constructConnectionsForLine(e).map((function(t){return e.topContext.renderChild(t)}))}var L=this;try{for(var C=i(m),_=C.next();!_.done;_=C.next())E(O=_.value)}catch(e){l={error:e}}finally{try{_&&!_.done&&(c=C.return)&&c.call(C)}finally{if(l)throw l.error}}try{for(var I=i(m),S=I.next();!S.done;S=I.next()){var O;(O=S.value).update(),O.topContext.update()}}catch(e){u={error:e}}finally{try{S&&!S.done&&(h=I.return)&&h.call(I)}finally{if(u)throw u.error}}},v.prototype.onLabelCreated=function(e){var t=r(this.findRangeInLines(e.startIndex,e.endIndex),2),n=t[0];if(t[1]===n+1){var o=this.lines[n],i=new u.LabelView.Entity(e,o.topContext,this.config);this.labelViewRepository.add(i),o.topContext.addChild(i),o.topContext.renderChild(i),o.topContext.update(),o.update()}else{var s=this.findHardLineEndsInIndex(n);this.rerenderLines(n,s)}v.layoutTopContextsAfter(this.lines[n]),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.findRangeInLines=function(e,t){var n=0,r=0;return this.lines.forEach((function(o,i){o.startIndex<=e&&e<o.endIndex&&(n=i),o.startIndex<=t-1&&t-1<o.endIndex&&(r=i+1)})),[n,r]},v.prototype.onConnectionCreated=function(e){var t=this.labelViewRepository.get(e.priorLabel.id),n=t.lineIn.topContext,r=new h.ConnectionView.Entity(e,n,this.config);this.connectionViewRepository.add(r),n.addChild(r),n.renderChild(r),n.update(),t.lineIn.update(),v.layoutTopContextsAfter(t.lineIn),this.config.contentEditable&&this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.onContentSpliced=function(e,t,n){""!==t&&this.onRemoved(e,t),""!==n&&this.onInserted(e,n)},v.prototype.onRemoved=function(e,t){var n=r(this.findRangeInLines(e,e+1),2),o=n[0];n[1],this.lines[o].startIndex===e-t.length?this.lines[o].move(-t.length):this.lines[o].inserted(-t.length);for(var i=o+1;i<this.lines.length;)this.lines[i].move(-t.length),++i;var s=this.findHardLineEndsInIndex(o);if("\n"===t&&this.lines[o].isBlank){var a=this.lines[o].last,l=this.lines[o].next;this.lines[o].remove(),this.lines.splice(o,1),a.map((function(e){return e.next=l})),l.map((function(e){return e.last=a}))}else this.rerenderLines(o,s);v.layoutTopContextsAfter(this.lines[s-1]);var c=Array.from(t).filter((function(e){return"\n"===e})).length;0===c?(this.contentEditor.characterIndex-=t.length,this.contentEditor.avoidInLabel("forward")):0<=this.contentEditor.lineIndex-c&&(this.contentEditor.lineIndex-=c,this.contentEditor.characterIndex=this.contentEditor.line.content.length,this.contentEditor.avoidInLabel("forward")),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.onInserted=function(e,t){var n=r(this.findRangeInLines(e,e+1),2),o=n[0];n[1],this.lines[o].startIndex===e+t.length?this.lines[o].move(t.length):this.lines[o].inserted(t.length);for(var i=o+1;i<this.lines.length;)this.lines[i].move(t.length),++i;var s=this.findHardLineEndsInIndex(o);this.rerenderLines(o,s),v.layoutTopContextsAfter(this.lines[s]);var a=Array.from(t),l=a.filter((function(e){return"\n"===e})).length,c=a.lastIndexOf("\n"),u=t.length-c;0===l?this.contentEditor.characterIndex+=t.length:(this.contentEditor.lineIndex+=l,this.contentEditor.characterIndex=u-1),this.contentEditor.avoidInLabel("forward"),this.contentEditor.update(),this.svgElement.style.height=this.height.toString()+"px"},v.prototype.findHardLineEndsInIndex=function(e){var t;for(t=e;t<this.lines.length-1&&!this.lines[t].endWithHardLineBreak;++t);return t},v.prototype.collectStyle=function(){var e=document.createElementNS(s.SVGNS,"style"),t="\n        "+this.config.contentClasses.map((function(e){return"."+e})).join(",")+" {\n            font-family: "+this.contentFont.fontFamily+";\n            font-weight: "+this.contentFont.fontWeight+";\n            font-size: "+this.contentFont.fontSize+"px;\n            line-height: "+this.contentFont.lineHeight+"px;\n        }\n        ",n="\n        "+this.config.labelClasses.map((function(e){return"."+e})).join(",")+" {\n            font-family: "+this.labelFont.fontFamily+";\n            font-weight: "+this.labelFont.fontWeight+";\n            font-size: "+this.labelFont.fontSize+"px;\n        }\n        ",r=this.config.connectionClasses.map((function(e){return"."+e})).join(","),o=this.config.connectionClasses.map((function(e){return"."+e+"-line"})).join(","),i="\n        "+r+" {\n            font-family: "+this.connectionFont.fontFamily+";\n            font-weight: "+this.connectionFont.fontWeight+";\n            font-size: "+this.connectionFont.fontSize+"px;\n        }\n        "+o+" {\n            stroke: #000;\n        }\n        ";return e.innerHTML=t+n+i,e},Object.defineProperty(v.prototype,"paddingLeft",{get:function(){var e=this;return Math.max.apply(Math,o(Array.from(this.store.labelCategoryRepo.values()).map((function(t){return e.labelFont.widthOf(t.text)}))))/2+1},enumerable:!0,configurable:!0}),v);function v(e,t,n){var i,p,y;this.root=e,this.svgElement=t,this.config=n,this.contentEditor=null,this.store=e.store,this.labelViewRepository=new u.LabelView.Repository,this.connectionViewRepository=new h.ConnectionView.Repository,this.markerElement=v.createMarkerElement(),this.svgElement.appendChild(this.markerElement),this.textElement=document.createElementNS(s.SVGNS,"text"),this.textElement.style.whiteSpace="pre",this.textElement.style.wordWrap="normal",this.svgElement.appendChild(this.textElement);var m=Array.from(this.store.labelCategoryRepo.values()).map((function(e){return e.text})).join(""),b=Array.from(this.store.connectionCategoryRepo.values()).map((function(e){return e.text})).join("");i=r(l.Font.Factory.startBatch(t,this.textElement).thanCreate(n.contentClasses,this.store.content).thanCreate(n.labelClasses,m).thanCreate(n.connectionClasses,b).endBatch(),3),this.contentFont=i[0],this.labelFont=i[1],this.connectionFont=i[2];var g=this.labelFont.lineHeight+2+2*n.labelPadding+n.bracketWidth;this.topContextLayerHeight=2*n.topContextMargin+Math.max(g,this.connectionFont.lineHeight),(p=this.textElement.classList).add.apply(p,o(n.contentClasses)),this.labelCategoryElementFactoryRepository=new c.LabelCategoryElement.FactoryRepository(this,n),this.connectionCategoryElementFactoryRepository=new f.ConnectionCategoryElement.FactoryRepository(this,n),this.lineMaxWidth=t.width.baseVal.value-2*this.paddingLeft,this.lines=a.Line.Service.divide(this,0,this.store.content.length),this.lines.map(this.constructLabelViewsForLine.bind(this)),this.lines.map(this.constructConnectionsForLine.bind(this));var w=this.lines.map((function(e){return e.render()}));if((y=this.textElement).append.apply(y,o(w)),this.svgElement.style.height=this.height.toString()+"px",this.registerEventHandlers(),this.config.contentEditable){this.contentEditor=new d.ContentEditor(this);var x=r(this.contentEditor.render(),2),E=x[0],L=x[1];this.svgElement.appendChild(E),this.svgElement.parentNode.insertBefore(L,this.svgElement)}this.svgElement.appendChild(this.collectStyle())}t.View=y},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),s=n(0),a=n(19),l=n(20);!function(e){var t=(Object.defineProperty(n.prototype,"startIndex",{get:function(){return this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endIndex",{get:function(){return this._endIndex},enumerable:!0,configurable:!0}),n.prototype.move=function(e){this._startIndex+=e,this._endIndex+=e},n.prototype.inserted=function(e){this._endIndex+=e},Object.defineProperty(n.prototype,"dy",{get:function(){return this.last.match(this.view.contentFont.fontSize*this.config.lineHeight,this.view.contentFont.topToBaseLine)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.topContext.layer*this.view.topContextLayerHeight+this.view.contentFont.fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){var e=this;return l.takeWhile(this.view.lines,(function(t){return t!==e})).reduce((function(t,n){return t+n.height+e.view.contentFont.fontSize*(e.config.lineHeight-1)}),0)+this.topContext.layer*this.view.topContextLayerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBlank",{get:function(){return""===this.view.store.content.slice(this.startIndex,this.endIndex-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"content",{get:function(){return this.endWithHardLineBreak?this.isBlank?"⮐":this.view.store.content.slice(this.startIndex,this.endIndex-1):this.view.store.content.slice(this.startIndex,this.endIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endWithHardLineBreak",{get:function(){return"\n"===this.view.store.content[this.endIndex-1]},enumerable:!0,configurable:!0}),n.prototype.update=function(){this.svgElement.innerHTML=this.content.replace(/ /g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),this.isBlank&&(this.svgElement.style.fontSize=this.view.contentFont.fontSize/4+"px"),this.svgElement.setAttribute("x",this.view.paddingLeft.toString()),this.svgElement.setAttribute("dy",this.dy.toString()+"px")},n.prototype.render=function(){this.svgElement=document.createElementNS(s.SVGNS,"tspan");var e=r(this.topContext.render(),2),t=e[0],n=e[1];return this.view.svgElement.insertBefore(t,this.view.textElement),this.view.markerElement.insertAdjacentElement("afterend",n),Object.assign(this.svgElement,{annotatorElement:this}),this.update(),this.svgElement},n.prototype.remove=function(){this.topContext.remove(),this.svgElement.remove()},n.prototype.insertBefore=function(e){var t=this;this.render(),e.map((function(e){e.svgElement.parentNode.insertBefore(t.svgElement,e.svgElement),e.topContext.svgElement.parentNode.insertBefore(t.topContext.svgElement,e.topContext.svgElement),e.topContext.backgroundElement.parentNode.insertBefore(t.topContext.backgroundElement,e.topContext.backgroundElement)}))},n.prototype.insertAfter=function(e){var t=this;this.render(),e.map((function(e){e.svgElement.insertAdjacentElement("afterend",t.svgElement),e.topContext.svgElement.insertAdjacentElement("afterend",t.topContext.svgElement),e.topContext.backgroundElement.insertAdjacentElement("afterend",t.topContext.backgroundElement)}))},n.prototype.insertInto=function(e){this.render(),e.appendChild(this.svgElement)},n);function n(e,t,n,r,o){this.last=n,this.next=r,this.view=o,this.svgElement=null,this._startIndex=e,this._endIndex=t,this.topContext=new a.TopContext(this),this.config=o.config}e.ValueObject=t;var c=(Object.defineProperty(u.prototype,"store",{get:function(){return this.view.store},enumerable:!0,configurable:!0}),u.prototype.divide=function(e,t){var n,r;this.init();var s=e,a=e+1;do{var l=this.mergeLabel(a),c=this.mergeWord(l),u=l===a&&l===c;"\n"===this.store.content[a-1]?(0===this.tokenQueue.length?this.reduce(a-1,a):this.reduce(this.tokenQueue[0].startIndex,a),s=a):u&&(this.shiftWithAutoReduce({startIndex:s,endIndex:a}),s=a),++a}while(s<t);function h(e){f.map((function(t){return t.next=i.some(e)})),e.last=f,f=i.some(e)}0!==this.tokenQueue.length&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex);var f=i.none;try{for(var d=o(this.result),p=d.next();!p.done;p=d.next())h(p.value)}catch(e){n={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}return this.result},u.prototype.init=function(){this.result=[],this.tokenQueue=[]},u.prototype.mergeLabel=function(e){return this.store.labelRepo.getEntitiesCross(e-1).some((function(t){return t.endIndex>e}))?this.store.labelRepo.getEntitiesCross(e-1).filter((function(t){return t.endIndex>e})).sort((function(e,t){return t.endIndex-e.endIndex}))[0].endIndex:e},u.prototype.mergeWord=function(e){u.wordReg.lastIndex=0;var t=u.wordReg.exec(this.store.contentSlice(e-1,e+1));return null===t?e:2===t[0].length?e+1:e},u.prototype.reduce=function(t,n){var r=new e.ValueObject(t,n,i.none,i.none,this.view);this.result.push(r),this.tokenQueue=[]},u.prototype.shiftWithAutoReduce=function(e){var t=0===this.tokenQueue.length?0:this.view.contentWidth(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),n=this.view.contentWidth(e.startIndex,e.endIndex);0!==this.tokenQueue.length&&t+n>this.view.lineMaxWidth&&this.reduce(this.tokenQueue[0].startIndex,this.tokenQueue[this.tokenQueue.length-1].endIndex),n>this.view.lineMaxWidth?(this.reduce(e.startIndex,e.endIndex),console.warn('the token "'+this.store.contentSlice(e.startIndex,e.endIndex)+'" is too long for a line!')):this.tokenQueue.push(e)},u.wordReg=/([a-zA-z][a-zA-Z0-9'’]*[-|.]?)|([+\-]?[0-9.][0-9.%]*)/g,u);function u(e){this.view=e,this.result=[],this.tokenQueue=[]}(e.Service||(e.Service={})).divide=function(e,t,n){return new c(e).divide(t,n)}}(t.Line||(t.Line={}))},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),a=n(6),l=n(10),c=n(4),u=n(7),h=(Object.defineProperty(f.prototype,"layer",{get:function(){return 0===this.children.size?0:Math.max.apply(Math,o(Array.from(this.children).map((function(e){return e.layer}))))},enumerable:!0,configurable:!0}),f.prototype.update=function(){var e=this;this.children.forEach((function(e){return e.update()})),Array.from(this.children).filter((function(e){return e instanceof u.LabelView.Entity})).map((function(t){t.store.allConnections.forEach((function(n){if(e.belongTo.view.connectionViewRepository.has(n.id)){var r=e.belongTo.view.connectionViewRepository.get(n.id);r.mayNotSameLineLabelView===t&&r.update()}}))}))},f.prototype.render=function(){var e=this;return this.svgElement=document.createElementNS(s.SVGNS,"g"),this.backgroundElement=document.createElementNS(s.SVGNS,"g"),this.children.forEach((function(t){e.renderChild(t)})),this.update(),[this.svgElement,this.backgroundElement]},f.prototype.addChild=function(e){var t,n,r=this.layer,o=!1;e instanceof l.ConnectionView.Entity&&(e.layer=e.sameLineLabelView.layer);do{++e.layer,o=!1;try{for(var s=(t=void 0,i(this.children)),c=s.next();!c.done;c=s.next()){var u=c.value;if(a.overLaps(e,u)){o=!0;break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}}while(o);return this.children.add(e),this.layer-r},f.prototype.renderChild=function(e){c.assert(this.children.has(e));var t=e.render();this.svgElement.appendChild(t)},f.prototype.removeChild=function(e){c.assert(this.children.has(e)),this.children.delete(e)},f.prototype.remove=function(){this.svgElement.remove(),this.backgroundElement.remove()},f);function f(e){this.backgroundElement=null,this.svgElement=null,this.children=new Set,this.belongTo=e}t.TopContext=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);t.lookup=function(e,t){return e.length<=t?r.none:r.some(e[t])},t.takeWhile=function(e,t){var n;for(n=0;n<e.length&&t(e[n]);++n);return e.slice(0,n)}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var s,a,l,c,u=n(1),h=n(0),f=n(5);function d(e,t,n,r){this.store=e,this.font=t,this.padding=n,this.svgElement=document.createElementNS(h.SVGNS,"g");var o=document.createElementNS(h.SVGNS,"rect");o.setAttribute("fill",/^#/g.test(e.color)?f.addAlpha(e.color,r):e.color),o.setAttribute("stroke",e.borderColor),o.setAttribute("width",this.width.toString()),o.setAttribute("height",(t.lineHeight+2*n).toString()),o.setAttribute("rx",(2*n).toString()),o.style.cursor="pointer";var i=document.createElementNS(h.SVGNS,"text");i.style.userSelect="none",i.style.cursor="pointer",i.textContent=e.text,i.setAttribute("dx",n.toString()),i.setAttribute("dy",t.topToBaseLine+n+"px"),this.svgElement.appendChild(o),this.svgElement.appendChild(i)}function p(e,t){var n,r,o=l.call(this)||this;try{for(var s=i(e.store.labelCategoryRepo.values()),c=s.next();!c.done;c=s.next()){var u=c.value;o.add(new a(u,e.labelFont,t.labelPadding,t.labelOpacity))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return o}s=t.LabelCategoryElement||(t.LabelCategoryElement={}),Object.defineProperty(d.prototype,"width",{get:function(){return this.font.widthOf(this.store.text)+2*this.padding},enumerable:!0,configurable:!0}),d.prototype.create=function(){return this.svgElement.cloneNode(!0)},Object.defineProperty(d.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),a=d,l=u.Base.Repository,o(p,l),c=p,s.FactoryRepository=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var l,c,u,h,f=n(1),d=n(0);function p(e,t,n){var r;this.store=e,this.svgElement=document.createElementNS(d.SVGNS,"g");var o=document.createElementNS(d.SVGNS,"rect");o.setAttribute("fill","#ffffff"),o.setAttribute("width",t.widthOf(e.text).toString()),o.setAttribute("height",t.lineHeight.toString());var i=document.createElementNS(d.SVGNS,"text");(r=i.classList).add.apply(r,s(n)),i.textContent=e.text,i.setAttribute("dy",t.topToBaseLine+"px"),this.svgElement.appendChild(o),this.svgElement.appendChild(i)}function y(e,t){var n,r,o=u.call(this)||this;o.config=t;try{for(var i=a(e.store.connectionCategoryRepo.values()),s=i.next();!s.done;s=i.next()){var l=s.value;u.prototype.add.call(o,new c(l,e.connectionFont,t.connectionClasses))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}l=t.ConnectionCategoryElement||(t.ConnectionCategoryElement={}),Object.defineProperty(p.prototype,"id",{get:function(){return this.store.id},enumerable:!0,configurable:!0}),p.prototype.create=function(){return this.svgElement.cloneNode(!0)},c=p,u=f.Base.Repository,o(y,u),h=y,l.FactoryRepository=h},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),s=n(11),a=n(7),l=(Object.defineProperty(c.prototype,"characterIndex",{get:function(){return this._characterIndex},set:function(e){this.view.lines[this._lineIndex].isBlank?this._characterIndex=0:this._characterIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"lineIndex",{get:function(){return this._lineIndex},set:function(e){this._lineIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"line",{get:function(){return this.view.lines[this.lineIndex]},enumerable:!0,configurable:!0}),c.prototype.render=function(){var e=this;return this.constructCaretElement(),this.constructHiddenTextAreaElement(),this.parentSVGYOffset=this.view.svgElement.getBoundingClientRect().top-document.getElementsByTagName("html")[0].getBoundingClientRect().top,this.hiddenTextAreaElement.onkeyup=function(t){if(!e.inComposition){switch(t.key){case"ArrowLeft":0===e.characterIndex?e.line.last.isSome&&(--e.lineIndex,e.characterIndex=e.line.content.length):(--e.characterIndex,e.avoidInLabel("backward"));break;case"ArrowRight":e.characterIndex>=e.line.content.length||e.line.isBlank?e.line.next.isSome&&(++e.lineIndex,e.characterIndex=0):(++e.characterIndex,e.avoidInLabel("forward"));break;case"ArrowUp":e.line.last.isSome&&--e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel("forward");break;case"ArrowDown":e.line.next.isSome&&++e.lineIndex,e.characterIndex=Math.min(e.characterIndex,e.line.content.length),e.avoidInLabel("forward");break;case"Backspace":var n=e.line.startIndex+e.characterIndex-1;e.view.root.emit("contentDelete",n,1);break;default:if(""!==e.hiddenTextAreaElement.value){s.Font.Service.measureMore(e.view.contentFont,e.hiddenTextAreaElement.value,e.view.config.contentClasses,e.view.textElement);var r=e.view.lines[e._lineIndex].startIndex+e.characterIndex;e.view.root.emit("contentInput",r,e.hiddenTextAreaElement.value),e.hiddenTextAreaElement.value=""}}e.update()}},this.hiddenTextAreaElement.addEventListener("compositionstart",(function(){e.inComposition=!0})),this.hiddenTextAreaElement.addEventListener("compositionend",(function(){e.inComposition=!1})),this.update(),this.hiddenTextAreaElement.style.opacity="0",[this.cursorElement,this.hiddenTextAreaElement]},c.prototype.avoidInLabel=function(e){for(var t=this.line.startIndex+this.characterIndex,n=Array.from(this.line.topContext.children).filter((function(e){return e instanceof a.LabelView.Entity})),r=n.find((function(e){return e.store.startIndex<=t-1&&t<e.store.endIndex}));void 0!==r;)"forward"===e?++this.characterIndex:--this.characterIndex,t=this.line.startIndex+this.characterIndex,r=n.find((function(e){return e.store.startIndex<=t-1&&t<e.store.endIndex}))},c.prototype.update=function(){var e=this.view.paddingLeft+this.view.contentFont.widthOf(this.line.content.slice(0,this.characterIndex));this.cursorElement.setAttribute("d","\n            M"+e+","+this.line.y+"\n            L"+e+","+(this.line.y+this.view.contentFont.lineHeight)+"\n        "),this.hiddenTextAreaElement.style.top=this.parentSVGYOffset+this.line.y+"px",this.hiddenTextAreaElement.style.left=this.cursorElement.getBoundingClientRect().left+"px"},c.prototype.caretChanged=function(e){var t=window.getSelection();if("Caret"===t.type){var n=document.querySelector("svg").getClientRects()[0];if(null!==t.anchorNode.parentNode){var r=t.anchorNode.parentNode.getExtentOfChar(0);if(n.top+r.y+this.view.contentFont.lineHeight<=e){var o=t.anchorNode.parentNode.nextSibling.annotatorElement;this._lineIndex=this.view.lines.indexOf(o),this.characterIndex=0,this.avoidInLabel("forward")}else o=t.anchorNode.parentNode.annotatorElement,this._lineIndex=this.view.lines.indexOf(o),this.characterIndex=t.anchorOffset,this.avoidInLabel("forward");this.update(),this.hiddenTextAreaElement.focus({preventScroll:!0})}}},c.prototype.constructHiddenTextAreaElement=function(){var e;this.hiddenTextAreaElement=document.createElement("textarea"),this.hiddenTextAreaElement.setAttribute("autocorrect","off"),this.hiddenTextAreaElement.setAttribute("autocapitalize","off"),this.hiddenTextAreaElement.setAttribute("spellcheck","false"),(e=this.hiddenTextAreaElement.classList).add.apply(e,o(this.view.config.contentClasses)),this.hiddenTextAreaElement.style.position="absolute",this.hiddenTextAreaElement.style.padding="0",this.hiddenTextAreaElement.style.width="100vw",this.hiddenTextAreaElement.style.height="1em",this.hiddenTextAreaElement.style.outline="none",this.hiddenTextAreaElement.style.zIndex="-1",this.hiddenTextAreaElement.style.borderStyle="none",this.hiddenTextAreaElement.style.fontFamily=this.view.contentFont.fontFamily,this.hiddenTextAreaElement.style.fontSize=this.view.contentFont.fontSize+"px",this.hiddenTextAreaElement.style.fontWeight=this.view.contentFont.fontWeight,this.hiddenTextAreaElement.style.opacity="0"},c.prototype.constructCaretElement=function(){this.cursorElement=document.createElementNS(i.SVGNS,"path"),this.cursorElement.setAttribute("stroke","#000000"),this.cursorElement.setAttribute("stroke-width","1.5"),this.cursorElement.style.animationName="cursor",this.cursorElement.style.animationDuration="0.75s",this.cursorElement.style.animationTimingFunction="ease-out",this.cursorElement.style.animationDirection="alternate",this.cursorElement.style.animationIterationCount="infinite"},c.prototype.hide=function(){this.cursorElement.style.display="none"},c.prototype.show=function(){this.cursorElement.style.display="inline"},c.prototype.remove=function(){this.hiddenTextAreaElement.remove()},c);function c(e){this.view=e,this.cursorElement=null,this.hiddenTextAreaElement=null,this.parentSVGYOffset=null;var t=document.getElementsByTagName("head")[0],n=document.createElement("style");n.innerHTML="@keyframes cursor { from { opacity: 0; } to { opacity: 1; }  }",t.appendChild(n),this._lineIndex=0,this._characterIndex=0,this.inComposition=!1}t.ContentEditor=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={contentClasses:["poplar-annotation-content"],labelClasses:["poplar-annotation-label"],connectionClasses:["poplar-annotation-connection"],labelPadding:2,lineHeight:1.5,topContextMargin:3,bracketWidth:8,allowMultipleLabel:"differentCategory",allowMultipleConnection:"differentCategory",labelWidthCalcMethod:"max",connectionWidthCalcMethod:"line",labelOpacity:90,defaultLabelColor:"#ff9d61",selectingAreaStrip:/[\n ]/,unconnectedLineStyle:"curve",contentEditable:!0};t.parseInput=function(e){var t={};for(var n in r)t[n]=void 0!==e[n]?e[n]:r[n];return t}},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(4),s=(a.prototype.getSelectionInfo=function(){var e,t=this,n=window.getSelection();i.assert("Range"===n.type);var s,a,l,c,u=null,h=null;try{u=n.anchorNode.parentNode,h=n.focusNode.parentNode}catch(e){return null}try{if(s=u.annotatorElement,a=h.annotatorElement,s.view!==this.root.view||a.view!==this.root.view)return null;l=s.startIndex+n.anchorOffset,c=a.startIndex+n.focusOffset}catch(e){return null}return c<l&&(e=r([c,l],2),l=e[0],c=e[1]),o.fromNullable(this.config.selectingAreaStrip).map((function(e){for(;e.test(t.root.store.content[l]);)++l;for(;e.test(t.root.store.content[c-1]);)--c})),c<=l?null:{startIndex:l,endIndex:c}},a.prototype.textSelected=function(){var e,t=this.getSelectionInfo();t&&this.root.emit("textSelected",t.startIndex,t.endIndex),null===(e=window.getSelection())||void 0===e||e.removeAllRanges()},a);function a(e,t){this.root=e,this.config=t}t.TextSelectionHandler=s},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e};function i(e,t){var n,r=this;this.root=e,this.config=t,this.lastSelection=a.none,this.svgElement=document.createElementNS(s.SVGNS,"path"),(n=this.svgElement.classList).add.apply(n,o(e.view.config.connectionClasses.map((function(e){return e+"-line"})))),this.svgElement.setAttribute("fill","none"),this.svgElement.style.markerEnd="url(#marker-arrow)",this.root.on("labelClicked",(function(e){r.lastSelection.isSome?(r.root.emit("twoLabelsClicked",r.lastSelection.toNullable().id,e),r.svgElement.remove(),r.svgElement.setAttribute("d",""),r.lastSelection=a.none):(r.lastSelection=a.some(r.root.view.labelViewRepository.get(e)),r.root.view.svgElement.insertBefore(r.svgElement,r.root.view.svgElement.firstChild))})),this.root.view.svgElement.onmousemove=function(e){r.lastSelection.map((function(n){var o=n.labelLeft+1,i=n.labelRight-1,s=n.globalY+1,a=e.clientX-r.root.view.svgElement.getBoundingClientRect().left,l=e.clientY-r.root.view.svgElement.getBoundingClientRect().top,c=(o+i)/2<a?o:i;if("straight"===t.unconnectedLineStyle)r.svgElement.setAttribute("d","\n                    M"+c+","+s+"\n                    L"+a+","+l+"\n                ");else if("curve"===t.unconnectedLineStyle){var u=(o-a)/4,h=Math.min(s,l)-20;r.svgElement.setAttribute("d","\n                        M"+c+","+s+"\n                        C"+(c-u)+","+h+","+(a+u)+","+h+","+a+","+l+"\n                    ")}}))},this.root.view.svgElement.oncontextmenu=function(e){r.lastSelection.map((function(){r.svgElement.remove(),r.svgElement.setAttribute("d",""),r.lastSelection=a.none,e.preventDefault()}))}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),a=n(2);t.TwoLabelsClickedHandler=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9);!function(e){var t=(n.prototype.apply=function(e){e.connectionRepo.add(new r.Connection.Entity(null,this.categoryId,this.fromId,this.toId,e))},n);function n(e,t,n){this.categoryId=e,this.fromId=t,this.toId=n}e.CreateConnectionAction=t,e.Create=function(e,n,r){return new t(e,n,r)};var o=(i.prototype.apply=function(e){e.connectionRepo.delete(this.id)},i);function i(e){this.id=e}function s(e){return new o(e)}e.DeleteConnectionAction=o,e.Delete=s;var a=(l.prototype.apply=function(e){var t=e.connectionRepo.get(this.connectionId);s(this.connectionId).apply(e),e.connectionRepo.add(new r.Connection.Entity(this.connectionId,this.categoryId,t.fromId,t.toId,e))},l);function l(e,t){this.connectionId=e,this.categoryId=t}e.UpdateConnectionAction=a,e.Update=function(e,t){return new a(e,t)}}(t.Connection||(t.Connection={}))},function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8);!function(e){var t=(n.prototype.apply=function(e){if(e.content.slice(this.startIndex,this.endIndex).includes("\n"))throw Error("Insert label across hard line is not supported now! Please remove the \\n in content first!");e.labelRepo.add(new o.Label.Entity(null,this.categoryId,this.startIndex,this.endIndex,e))},n);function n(e,t,n){this.categoryId=e,this.startIndex=t,this.endIndex=n}e.CreateLabelAction=t,e.Create=function(e,n,r){return new t(e,n,r)};var i=(s.prototype.apply=function(e){var t,n;try{for(var o=r(e.labelRepo.get(this.id).allConnections),i=o.next();!i.done;i=o.next()){var s=i.value;e.connectionRepo.delete(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}e.labelRepo.delete(this.id)},s);function s(e){this.id=e}function a(e){return new i(e)}e.DeleteLabelAction=i,e.Delete=a;var l=(c.prototype.apply=function(e){var t=e.labelRepo.get(this.labelId),n=t.allConnections;a(this.labelId).apply(e),e.labelRepo.add(new o.Label.Entity(this.labelId,this.categoryId,t.startIndex,t.endIndex,e)),n.forEach((function(t){return e.connectionRepo.add(t)}))},c);function c(e,t){this.labelId=e,this.categoryId=t}e.UpdateLabelAction=l,e.Update=function(e,t){return new l(e,t)}}(t.Label||(t.Label={}))},function(e,t,n){"use strict";var r,o;function i(e,t,n){this.startIndex=e,this.removeLength=t,this.insert=n}Object.defineProperty(t,"__esModule",{value:!0}),r=t.Content||(t.Content={}),i.prototype.apply=function(e){if(!e.config.contentEditable)throw Error("Content edition is not on!");e.spliceContent(this.startIndex,this.removeLength,this.insert)},o=i,r.SpliceAction=o,r.Splice=function(e,t,n){return new o(e,t,n)}}],e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(e){return t[e]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=12);function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t,n}))},cb29:function(e,t,n){var r=n("23e7"),o=n("81d5"),i=n("44d2");r({target:"Array",proto:!0},{fill:o}),i("fill")},d28b:function(e,t,n){var r=n("746f");r("iterator")},e01a:function(e,t,n){"use strict";var r=n("23e7"),o=n("83ab"),i=n("da84"),s=n("5135"),a=n("861d"),l=n("9bf2").f,c=n("e893"),u=i.Symbol;if(o&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var h={},f=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof f?new u(e):void 0===e?u():u(e);return""===e&&(h[t]=!0),t};c(f,u);var d=f.prototype=u.prototype;d.constructor=f;var p=d.toString,y="Symbol(test)"==String(u("test")),v=/^Symbol\((.*)\)[^)]+$/;l(d,"description",{configurable:!0,get:function(){var e=a(this)?this.valueOf():this,t=p.call(e);if(s(h,e))return"";var n=y?t.slice(7,-1):t.replace(v,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:f})}},e9c4:function(e,t,n){var r=n("23e7"),o=n("d066"),i=n("d039"),s=o("JSON","stringify"),a=/[\uD800-\uDFFF]/g,l=/^[\uD800-\uDBFF]$/,c=/^[\uDC00-\uDFFF]$/,u=function(e,t,n){var r=n.charAt(t-1),o=n.charAt(t+1);return l.test(e)&&!c.test(o)||c.test(e)&&!l.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},h=i((function(){return'"\\udf06\\ud834"'!==s("\udf06\ud834")||'"\\udead"'!==s("\udead")}));s&&r({target:"JSON",stat:!0,forced:h},{stringify:function(e,t,n){var r=s.apply(null,arguments);return"string"==typeof r?r.replace(a,u):r}})},ec26:function(e,t,n){"use strict";var r,o=new Uint8Array(16);function i(){if(!r&&(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(e){return"string"===typeof e&&s.test(e)}for(var l=a,c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!l(n))throw TypeError("Stringified UUID is invalid");return n}var f=h;function d(e,t,n){e=e||{};var r=e.random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return f(r)}t["a"]=d}}]);